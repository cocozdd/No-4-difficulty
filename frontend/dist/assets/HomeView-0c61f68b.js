import{r as le,d as ne,u as de,a as h,c as T,o as re,w as ce,b as ie,e as c,f as p,g as a,h as o,i as t,j as K,F as x,k as U,l as b,m as F,n as r,p as i,t as d,q as ue,s as _e,E as Y,_ as pe}from"./index-1ba1cfa6.js";import{u as me,f as ge,a as ve}from"./goodsStore-a546335a.js";import{g as B}from"./image-d30f5149.js";const fe=async v=>{const{data:y}=await le.post("/diagnostics/kafka/order-events",v);return y},k=v=>(ue("data-v-d6a1a0da"),v=v(),_e(),v),ke={class:"home-view"},ye={class:"hero"},he=k(()=>a("h1",null,"Welcome to Campus Market",-1)),be=k(()=>a("p",null,"Trade idle items, share campus resources, and keep transactions simple.",-1)),Ie={class:"flash-sale-entry"},Ve={key:0,class:"hot-goods"},we=k(()=>a("h2",null,"Latest Picks",-1)),Ce=["src"],Se={class:"goods-content"},Ne={class:"price"},Te={class:"stock"},Ke={class:"seller"},xe={key:1,class:"category-highlights"},Ue=k(()=>a("h2",null,"Category Highlights",-1)),Fe={class:"category-chip"},Ge=["src"],Me={class:"goods-content"},Ae={class:"price"},Be={class:"stock"},De={class:"seller"},Ee={class:"ranking-section"},Le={class:"ranking-header"},Re=k(()=>a("h2",null,"Top Ranking",-1)),He={class:"ranking-tabs"},ze=["onClick"],$e={class:"ranking-index"},qe=["src"],Oe={class:"ranking-meta"},Ye={class:"ranking-score"},je={class:"ranking-price"},Pe={key:2,class:"diagnostics-section"},We={class:"diagnostics-header"},Je=k(()=>a("span",null,"Kafka 快速测试",-1)),D=3,Qe=5,Xe=ne({__name:"HomeView",setup(v){const y=de(),G=me(),I=h([]),E=T(()=>I.value.length?I.value.slice(0,D):G.goods.slice(0,D)),L=T(()=>{const l=new Map;return G.goods.forEach(s=>{l.has(s.category)||l.set(s.category,s)}),Array.from(l.entries()).map(([s,_])=>({category:s,item:_}))}),j=async()=>{try{const{data:l}=await ge(D);I.value=l.map(s=>s.goods)}catch{I.value=[]}},R=[{value:"orders",label:"Orders"},{value:"views",label:"Views"},{value:"carts",label:"Carts"}],f=h("orders"),V=h([]),P=T(()=>{var l;return((l=R.find(s=>s.value===f.value))==null?void 0:l.label)??"Score"}),H=async l=>{try{const{data:s}=await ve(l,Qe);V.value=s}catch{V.value=[]}},W=l=>{l!==f.value&&(f.value=l)};re(()=>{G.loadGoods(),j(),H(f.value)}),ce(f,l=>{H(l)});const J=!1,z=()=>({message:"Kafka smoke test",key:"",orderId:"",goodsId:"",buyerId:"",currentStatus:"TEST",previousStatus:""}),n=ie(z()),w=h(!1),u=h(null),Q=T(()=>{if(!u.value)return"";const l=new Date(u.value.dispatchedAt);return Number.isNaN(l.getTime())?u.value.dispatchedAt:l.toLocaleString()}),M=l=>{const s=l.trim();if(!s)return;const _=Number(s);return Number.isNaN(_)?void 0:_},X=async()=>{if(!n.message.trim()){Y.warning("请输入测试消息");return}w.value=!0;try{const l={message:n.message.trim(),key:n.key.trim()||void 0,orderId:M(n.orderId),goodsId:M(n.goodsId),buyerId:M(n.buyerId),currentStatus:n.currentStatus.trim()||void 0,previousStatus:n.previousStatus.trim()||void 0},s=await fe(l);u.value=s,Y.success("Kafka 测试事件已发送")}catch{}finally{w.value=!1}},Z=()=>{Object.assign(n,z()),u.value=null},ee=()=>y.push("/goods"),A=l=>y.push(`/goods/${l}`),se=()=>y.push("/flash-sale");return(l,s)=>{const _=c("el-button"),$=c("el-tag"),C=c("el-card"),q=c("el-col"),O=c("el-row"),oe=c("el-empty"),g=c("el-input"),m=c("el-form-item"),ae=c("el-form"),S=c("el-descriptions-item"),te=c("el-descriptions");return r(),p("div",ke,[a("section",ye,[he,be,o(_,{type:"primary",size:"large",onClick:ee},{default:t(()=>[i("Browse Listings")]),_:1}),a("div",Ie,[o($,{type:"danger",effect:"plain",size:"large",class:"flash-sale-tag",onClick:se},{default:t(()=>[i(" Flash Sale 秒杀专区 ")]),_:1})])]),E.value.length?(r(),p("section",Ve,[we,o(O,{gutter:16},{default:t(()=>[(r(!0),p(x,null,U(E.value,e=>(r(),b(q,{key:e.id,xs:24,sm:12,md:8},{default:t(()=>[o(C,{shadow:"hover",class:"goods-card",onClick:N=>A(e.id)},{default:t(()=>[a("img",{src:e.coverImageUrl||F(B)(e.category),alt:"",class:"goods-cover"},null,8,Ce),a("div",Se,[a("h3",null,d(e.title),1),a("p",Ne,"CNY "+d(e.price),1),a("p",Te,"Available: "+d(e.quantity),1),a("p",Ke,"Seller: "+d(e.sellerNickname),1)])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})])):K("",!0),L.value.length?(r(),p("section",xe,[Ue,o(O,{gutter:16},{default:t(()=>[(r(!0),p(x,null,U(L.value,e=>(r(),b(q,{key:e.category,xs:24,sm:12,md:8},{default:t(()=>[o(C,{shadow:"hover",class:"goods-card",onClick:N=>A(e.item.id)},{default:t(()=>[a("div",Fe,d(e.category),1),a("img",{src:e.item.coverImageUrl||F(B)(e.category),alt:"",class:"goods-cover"},null,8,Ge),a("div",Me,[a("h3",null,d(e.item.title),1),a("p",Ae,"CNY "+d(e.item.price),1),a("p",Be,"Available: "+d(e.item.quantity),1),a("p",De,"Seller: "+d(e.item.sellerNickname),1)])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})])):K("",!0),a("section",Ee,[a("div",Le,[Re,a("div",He,[(r(),p(x,null,U(R,e=>o(_,{key:e.value,size:"small",type:e.value===f.value?"primary":"default",onClick:N=>W(e.value)},{default:t(()=>[i(d(e.label),1)]),_:2},1032,["type","onClick"])),64))])]),V.value.length?(r(),b(C,{key:1,shadow:"never",class:"ranking-card"},{default:t(()=>[(r(!0),p(x,null,U(V.value,(e,N)=>(r(),p("div",{key:e.goods.id,class:"ranking-item",onClick:Ze=>A(e.goods.id)},[a("span",$e,d(N+1),1),a("img",{src:e.goods.coverImageUrl||F(B)(e.goods.category),alt:"",class:"ranking-cover"},null,8,qe),a("div",Oe,[a("h3",null,d(e.goods.title),1),a("p",Ye,d(P.value)+": "+d(e.score.toFixed(0)),1),a("p",je,"CNY "+d(e.goods.price),1)])],8,ze))),128))]),_:1})):(r(),b(oe,{key:0,description:"No ranking data yet"}))]),F(J)?(r(),p("section",Pe,[o(C,{shadow:"hover"},{header:t(()=>[a("div",We,[Je,o($,{type:"info",size:"small"},{default:t(()=>[i("开发环境")]),_:1})])]),default:t(()=>[o(ae,{model:n,"label-width":"110px",size:"small",class:"diagnostics-form"},{default:t(()=>[o(m,{label:"测试消息"},{default:t(()=>[o(g,{modelValue:n.message,"onUpdate:modelValue":s[0]||(s[0]=e=>n.message=e),placeholder:"例如：Kafka smoke test"},null,8,["modelValue"])]),_:1}),o(m,{label:"自定义 Key"},{default:t(()=>[o(g,{modelValue:n.key,"onUpdate:modelValue":s[1]||(s[1]=e=>n.key=e),placeholder:"可选：默认自动生成"},null,8,["modelValue"])]),_:1}),o(m,{label:"Order ID"},{default:t(()=>[o(g,{modelValue:n.orderId,"onUpdate:modelValue":s[2]||(s[2]=e=>n.orderId=e),placeholder:"可选数字"},null,8,["modelValue"])]),_:1}),o(m,{label:"Goods ID"},{default:t(()=>[o(g,{modelValue:n.goodsId,"onUpdate:modelValue":s[3]||(s[3]=e=>n.goodsId=e),placeholder:"可选数字"},null,8,["modelValue"])]),_:1}),o(m,{label:"Buyer ID"},{default:t(()=>[o(g,{modelValue:n.buyerId,"onUpdate:modelValue":s[4]||(s[4]=e=>n.buyerId=e),placeholder:"可选数字"},null,8,["modelValue"])]),_:1}),o(m,{label:"当前状态"},{default:t(()=>[o(g,{modelValue:n.currentStatus,"onUpdate:modelValue":s[5]||(s[5]=e=>n.currentStatus=e),placeholder:"默认 TEST"},null,8,["modelValue"])]),_:1}),o(m,{label:"上一状态"},{default:t(()=>[o(g,{modelValue:n.previousStatus,"onUpdate:modelValue":s[6]||(s[6]=e=>n.previousStatus=e),placeholder:"可选"},null,8,["modelValue"])]),_:1}),o(m,null,{default:t(()=>[o(_,{type:"primary",loading:w.value,onClick:X},{default:t(()=>[i(" 发送 Kafka 消息 ")]),_:1},8,["loading"]),o(_,{onClick:Z,disabled:w.value},{default:t(()=>[i("重置")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"]),u.value?(r(),b(te,{key:0,column:1,size:"small",border:"",title:"最近一次发送",class:"diagnostics-result"},{default:t(()=>[o(S,{label:"Topic"},{default:t(()=>[i(d(u.value.topic),1)]),_:1}),o(S,{label:"Key"},{default:t(()=>[i(d(u.value.key),1)]),_:1}),o(S,{label:"时间"},{default:t(()=>[i(d(Q.value),1)]),_:1}),o(S,{label:"备注"},{default:t(()=>[i(d(u.value.message),1)]),_:1})]),_:1})):K("",!0)]),_:1})])):K("",!0)])}}});const as=pe(Xe,[["__scopeId","data-v-d6a1a0da"]]);export{as as default};
