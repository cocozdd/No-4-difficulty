import{r as ae,d as le,u as ne,a as y,c as T,o as de,w as re,b as ce,e as c,f as _,g as t,h as o,i as a,j as K,F as x,k as U,l as h,m as G,n as r,p as m,t as d,q as ie,s as ue,E as O,_ as _e}from"./index-4373494d.js";import{u as me,f as pe,a as ge}from"./goodsStore-c6f4904d.js";import{g as D}from"./image-d30f5149.js";const ve=async v=>{const{data:b}=await ae.post("/diagnostics/kafka/order-events",v);return b},k=v=>(ie("data-v-5ecedbde"),v=v(),ue(),v),fe={class:"home-view"},ke={class:"hero"},ye=k(()=>t("h1",null,"Welcome to Campus Market",-1)),he=k(()=>t("p",null,"Trade idle items, share campus resources, and keep transactions simple.",-1)),be={key:0,class:"hot-goods"},Ie=k(()=>t("h2",null,"Latest Picks",-1)),Ve=["src"],we={class:"goods-content"},Ce={class:"price"},Se={class:"stock"},Ne={class:"seller"},Te={key:1,class:"category-highlights"},Ke=k(()=>t("h2",null,"Category Highlights",-1)),xe={class:"category-chip"},Ue=["src"],Ge={class:"goods-content"},Me={class:"price"},Ae={class:"stock"},Be={class:"seller"},De={class:"ranking-section"},Ee={class:"ranking-header"},Fe=k(()=>t("h2",null,"Top Ranking",-1)),Le={class:"ranking-tabs"},Re=["onClick"],He={class:"ranking-index"},ze=["src"],$e={class:"ranking-meta"},qe={class:"ranking-score"},Oe={class:"ranking-price"},Ye={key:2,class:"diagnostics-section"},je={class:"diagnostics-header"},Pe=k(()=>t("span",null,"Kafka 快速测试",-1)),E=3,We=5,Je=le({__name:"HomeView",setup(v){const b=ne(),M=me(),I=y([]),F=T(()=>I.value.length?I.value.slice(0,E):M.goods.slice(0,E)),L=T(()=>{const l=new Map;return M.goods.forEach(s=>{l.has(s.category)||l.set(s.category,s)}),Array.from(l.entries()).map(([s,u])=>({category:s,item:u}))}),Y=async()=>{try{const{data:l}=await pe(E);I.value=l.map(s=>s.goods)}catch{I.value=[]}},R=[{value:"orders",label:"Orders"},{value:"views",label:"Views"},{value:"carts",label:"Carts"}],f=y("orders"),V=y([]),j=T(()=>{var l;return((l=R.find(s=>s.value===f.value))==null?void 0:l.label)??"Score"}),H=async l=>{try{const{data:s}=await ge(l,We);V.value=s}catch{V.value=[]}},P=l=>{l!==f.value&&(f.value=l)};de(()=>{M.loadGoods(),Y(),H(f.value)}),re(f,l=>{H(l)});const W=!1,z=()=>({message:"Kafka smoke test",key:"",orderId:"",goodsId:"",buyerId:"",currentStatus:"TEST",previousStatus:""}),n=ce(z()),w=y(!1),i=y(null),J=T(()=>{if(!i.value)return"";const l=new Date(i.value.dispatchedAt);return Number.isNaN(l.getTime())?i.value.dispatchedAt:l.toLocaleString()}),A=l=>{const s=l.trim();if(!s)return;const u=Number(s);return Number.isNaN(u)?void 0:u},Q=async()=>{if(!n.message.trim()){O.warning("请输入测试消息");return}w.value=!0;try{const l={message:n.message.trim(),key:n.key.trim()||void 0,orderId:A(n.orderId),goodsId:A(n.goodsId),buyerId:A(n.buyerId),currentStatus:n.currentStatus.trim()||void 0,previousStatus:n.previousStatus.trim()||void 0},s=await ve(l);i.value=s,O.success("Kafka 测试事件已发送")}catch{}finally{w.value=!1}},X=()=>{Object.assign(n,z()),i.value=null},Z=()=>b.push("/goods"),B=l=>b.push(`/goods/${l}`);return(l,s)=>{const u=c("el-button"),C=c("el-card"),$=c("el-col"),q=c("el-row"),ee=c("el-empty"),se=c("el-tag"),g=c("el-input"),p=c("el-form-item"),oe=c("el-form"),S=c("el-descriptions-item"),te=c("el-descriptions");return r(),_("div",fe,[t("section",ke,[ye,he,o(u,{type:"primary",size:"large",onClick:Z},{default:a(()=>[m("Browse Listings")]),_:1})]),F.value.length?(r(),_("section",be,[Ie,o(q,{gutter:16},{default:a(()=>[(r(!0),_(x,null,U(F.value,e=>(r(),h($,{key:e.id,xs:24,sm:12,md:8},{default:a(()=>[o(C,{shadow:"hover",class:"goods-card",onClick:N=>B(e.id)},{default:a(()=>[t("img",{src:e.coverImageUrl||G(D)(e.category),alt:"",class:"goods-cover"},null,8,Ve),t("div",we,[t("h3",null,d(e.title),1),t("p",Ce,"CNY "+d(e.price),1),t("p",Se,"Available: "+d(e.quantity),1),t("p",Ne,"Seller: "+d(e.sellerNickname),1)])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})])):K("",!0),L.value.length?(r(),_("section",Te,[Ke,o(q,{gutter:16},{default:a(()=>[(r(!0),_(x,null,U(L.value,e=>(r(),h($,{key:e.category,xs:24,sm:12,md:8},{default:a(()=>[o(C,{shadow:"hover",class:"goods-card",onClick:N=>B(e.item.id)},{default:a(()=>[t("div",xe,d(e.category),1),t("img",{src:e.item.coverImageUrl||G(D)(e.category),alt:"",class:"goods-cover"},null,8,Ue),t("div",Ge,[t("h3",null,d(e.item.title),1),t("p",Me,"CNY "+d(e.item.price),1),t("p",Ae,"Available: "+d(e.item.quantity),1),t("p",Be,"Seller: "+d(e.item.sellerNickname),1)])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})])):K("",!0),t("section",De,[t("div",Ee,[Fe,t("div",Le,[(r(),_(x,null,U(R,e=>o(u,{key:e.value,size:"small",type:e.value===f.value?"primary":"default",onClick:N=>P(e.value)},{default:a(()=>[m(d(e.label),1)]),_:2},1032,["type","onClick"])),64))])]),V.value.length?(r(),h(C,{key:1,shadow:"never",class:"ranking-card"},{default:a(()=>[(r(!0),_(x,null,U(V.value,(e,N)=>(r(),_("div",{key:e.goods.id,class:"ranking-item",onClick:Qe=>B(e.goods.id)},[t("span",He,d(N+1),1),t("img",{src:e.goods.coverImageUrl||G(D)(e.goods.category),alt:"",class:"ranking-cover"},null,8,ze),t("div",$e,[t("h3",null,d(e.goods.title),1),t("p",qe,d(j.value)+": "+d(e.score.toFixed(0)),1),t("p",Oe,"CNY "+d(e.goods.price),1)])],8,Re))),128))]),_:1})):(r(),h(ee,{key:0,description:"No ranking data yet"}))]),G(W)?(r(),_("section",Ye,[o(C,{shadow:"hover"},{header:a(()=>[t("div",je,[Pe,o(se,{type:"info",size:"small"},{default:a(()=>[m("开发环境")]),_:1})])]),default:a(()=>[o(oe,{model:n,"label-width":"110px",size:"small",class:"diagnostics-form"},{default:a(()=>[o(p,{label:"测试消息"},{default:a(()=>[o(g,{modelValue:n.message,"onUpdate:modelValue":s[0]||(s[0]=e=>n.message=e),placeholder:"例如：Kafka smoke test"},null,8,["modelValue"])]),_:1}),o(p,{label:"自定义 Key"},{default:a(()=>[o(g,{modelValue:n.key,"onUpdate:modelValue":s[1]||(s[1]=e=>n.key=e),placeholder:"可选：默认自动生成"},null,8,["modelValue"])]),_:1}),o(p,{label:"Order ID"},{default:a(()=>[o(g,{modelValue:n.orderId,"onUpdate:modelValue":s[2]||(s[2]=e=>n.orderId=e),placeholder:"可选数字"},null,8,["modelValue"])]),_:1}),o(p,{label:"Goods ID"},{default:a(()=>[o(g,{modelValue:n.goodsId,"onUpdate:modelValue":s[3]||(s[3]=e=>n.goodsId=e),placeholder:"可选数字"},null,8,["modelValue"])]),_:1}),o(p,{label:"Buyer ID"},{default:a(()=>[o(g,{modelValue:n.buyerId,"onUpdate:modelValue":s[4]||(s[4]=e=>n.buyerId=e),placeholder:"可选数字"},null,8,["modelValue"])]),_:1}),o(p,{label:"当前状态"},{default:a(()=>[o(g,{modelValue:n.currentStatus,"onUpdate:modelValue":s[5]||(s[5]=e=>n.currentStatus=e),placeholder:"默认 TEST"},null,8,["modelValue"])]),_:1}),o(p,{label:"上一状态"},{default:a(()=>[o(g,{modelValue:n.previousStatus,"onUpdate:modelValue":s[6]||(s[6]=e=>n.previousStatus=e),placeholder:"可选"},null,8,["modelValue"])]),_:1}),o(p,null,{default:a(()=>[o(u,{type:"primary",loading:w.value,onClick:Q},{default:a(()=>[m(" 发送 Kafka 消息 ")]),_:1},8,["loading"]),o(u,{onClick:X,disabled:w.value},{default:a(()=>[m("重置")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"]),i.value?(r(),h(te,{key:0,column:1,size:"small",border:"",title:"最近一次发送",class:"diagnostics-result"},{default:a(()=>[o(S,{label:"Topic"},{default:a(()=>[m(d(i.value.topic),1)]),_:1}),o(S,{label:"Key"},{default:a(()=>[m(d(i.value.key),1)]),_:1}),o(S,{label:"时间"},{default:a(()=>[m(d(J.value),1)]),_:1}),o(S,{label:"备注"},{default:a(()=>[m(d(i.value.message),1)]),_:1})]),_:1})):K("",!0)]),_:1})])):K("",!0)])}}});const ss=_e(Je,[["__scopeId","data-v-5ecedbde"]]);export{ss as default};
