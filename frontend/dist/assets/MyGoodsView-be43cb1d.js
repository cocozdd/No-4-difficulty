import{d as K,u as X,a as k,b as Z,o as H,e as l,f as C,h as e,i as t,n as d,g as n,p as c,m as b,C as ee,l as g,j as E,F as te,k as oe,t as f,D as ae,E as y,K as se,q as le,s as re,_ as ne}from"./index-1ba1cfa6.js";import{u as ie}from"./goodsStore-a546335a.js";import{g as N}from"./image-d30f5149.js";const P=h=>(le("data-v-c958286e"),h=h(),re(),h),de={class:"my-goods-view"},ce={class:"card-header"},ue=P(()=>n("span",null,"Create New Listing",-1)),pe={class:"upload-row"},_e={class:"list-header"},me=P(()=>n("h2",null,"My Listings",-1)),ge=["src"],fe={class:"goods-body"},ye={class:"title-line"},ve={class:"tag-group"},he={class:"price"},Ie={class:"stock"},be={class:"description"},Ee=5*1024*1024,Ve=K({__name:"MyGoodsView",setup(h){const _=ie(),G=X(),U=k(),V=k(!1),I=k(!1),a=Z({title:"",description:"",category:"",price:1,quantity:1,coverImageUrl:""}),M={title:[{required:!0,message:"Title is required",trigger:"blur"}],category:[{required:!0,message:"Select a category",trigger:"change"}],price:[{required:!0,message:"Price is required",trigger:"change"}],quantity:[{required:!0,message:"Quantity is required",trigger:"change"}],description:[{required:!0,message:"Description is required",trigger:"blur"}]};H(()=>{_.loadMyGoods()});const S=()=>{_.loadMyGoods()},A=()=>!1,B=async u=>{var i,p;const s=u.raw;if(s){if(!s.type.startsWith("image/")){y.error("Only image files are allowed");return}if(s.size>Ee){y.error("Image size cannot exceed 5MB");return}I.value=!0;try{const{data:r}=await se(s);a.coverImageUrl=r.url,y.success("Image uploaded")}catch(r){const v=((p=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:p.message)||"Failed to upload image";y.error(v)}finally{I.value=!1}}},F=()=>{a.coverImageUrl=""},L=()=>{var u;(u=U.value)==null||u.validate(async s=>{if(s){V.value=!0;try{const i={...a};i.coverImageUrl||(i.coverImageUrl=N(i.category));const p=await _.createGoods(i);y.success("Listing submitted for review"),R(),_.loadMyGoods(),G.push(`/goods/${p.id}`)}catch{y.error("Failed to create listing")}finally{V.value=!1}}})},R=()=>{a.title="",a.description="",a.category="",a.price=1,a.quantity=1,a.coverImageUrl=""},T=u=>G.push(`/goods/${u}`),O={PENDING_REVIEW:"Pending Review",APPROVED:"Approved",REJECTED:"Rejected"},W={PENDING_REVIEW:"warning",APPROVED:"success",REJECTED:"danger"};return(u,s)=>{const i=l("el-tag"),p=l("el-input"),r=l("el-form-item"),v=l("el-option"),z=l("el-select"),q=l("el-input-number"),j=l("el-icon"),m=l("el-button"),$=l("el-upload"),J=l("el-image"),Q=l("el-form"),x=l("el-card"),w=l("el-col"),Y=l("el-empty"),D=l("el-row");return d(),C("div",de,[e(D,{gutter:24},{default:t(()=>[e(w,{xs:24,md:10},{default:t(()=>[e(x,{class:"form-card"},{header:t(()=>[n("div",ce,[ue,e(i,{type:"info"},{default:t(()=>[c("Practice mode")]),_:1})])]),default:t(()=>[e(Q,{ref_key:"formRef",ref:U,model:a,rules:M,"label-position":"top"},{default:t(()=>[e(r,{label:"Title",prop:"title"},{default:t(()=>[e(p,{modelValue:a.title,"onUpdate:modelValue":s[0]||(s[0]=o=>a.title=o),placeholder:"Example: Lightly used textbook",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(r,{label:"Category",prop:"category"},{default:t(()=>[e(z,{modelValue:a.category,"onUpdate:modelValue":s[1]||(s[1]=o=>a.category=o),placeholder:"Select category"},{default:t(()=>[e(v,{label:"Electronics",value:"Electronics"}),e(v,{label:"Books",value:"Books"}),e(v,{label:"Daily",value:"Daily"})]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"Price (CNY)",prop:"price"},{default:t(()=>[e(q,{modelValue:a.price,"onUpdate:modelValue":s[2]||(s[2]=o=>a.price=o),min:.01,step:1},null,8,["modelValue"])]),_:1}),e(r,{label:"Quantity",prop:"quantity"},{default:t(()=>[e(q,{modelValue:a.quantity,"onUpdate:modelValue":s[3]||(s[3]=o=>a.quantity=o),min:1,step:1},null,8,["modelValue"])]),_:1}),e(r,{label:"Description",prop:"description"},{default:t(()=>[e(p,{modelValue:a.description,"onUpdate:modelValue":s[4]||(s[4]=o=>a.description=o),type:"textarea",rows:4,placeholder:"Add detail such as condition, included accessories, etc."},null,8,["modelValue"])]),_:1}),e(r,{label:"Cover Image"},{default:t(()=>[n("div",pe,[e($,{class:"cover-upload","show-file-list":!1,"auto-upload":!1,accept:"image/*","before-upload":A,"on-change":B,disabled:I.value},{default:t(()=>[e(m,{type:"primary",loading:I.value},{icon:t(()=>[e(j,null,{default:t(()=>[e(b(ee))]),_:1})]),default:t(()=>[c(" Upload Image ")]),_:1},8,["loading"])]),_:1},8,["disabled"]),a.coverImageUrl?(d(),g(J,{key:0,src:a.coverImageUrl,fit:"cover",class:"cover-preview"},null,8,["src"])):E("",!0),a.coverImageUrl?(d(),g(m,{key:1,text:"",type:"danger",onClick:F},{default:t(()=>[c(" Remove ")]),_:1})):E("",!0)])]),_:1}),e(r,null,{default:t(()=>[e(m,{type:"primary",loading:V.value,onClick:L},{default:t(()=>[c("Submit")]),_:1},8,["loading"]),e(m,{onClick:R},{default:t(()=>[c("Reset")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),e(w,{xs:24,md:14},{default:t(()=>[n("div",_e,[me,e(m,{type:"text",onClick:S},{default:t(()=>[c("Refresh")]),_:1})]),b(_).myGoods.length?(d(),g(D,{key:1,gutter:16},{default:t(()=>[(d(!0),C(te,null,oe(b(_).myGoods,o=>(d(),g(w,{key:o.id,xs:24,sm:12},{default:t(()=>[e(x,{shadow:"hover",class:"goods-card"},{default:t(()=>[n("img",{src:o.coverImageUrl||b(N)(o.category),alt:"",class:"goods-cover"},null,8,ge),n("div",fe,[n("div",ye,[n("h3",null,f(o.title),1),n("div",ve,[e(i,{type:W[o.status],size:"small"},{default:t(()=>[c(f(O[o.status]),1)]),_:2},1032,["type"]),o.sold?(d(),g(i,{key:0,type:"warning",size:"small"},{default:t(()=>[c("Sold")]),_:1})):E("",!0)])]),n("p",he,"CNY "+f(o.price),1),n("p",Ie,"Available: "+f(o.quantity),1),n("p",be,f(o.description),1),o.status!=="APPROVED"?(d(),C("p",{key:0,class:ae(["status-hint",o.status==="PENDING_REVIEW"?"pending":"rejected"])},f(o.status==="PENDING_REVIEW"?"Waiting for admin review":"Rejected by admin. Edit and resubmit."),3)):E("",!0),e(m,{type:"text",onClick:we=>T(o.id)},{default:t(()=>[c("View detail")]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(d(),g(Y,{key:0,description:"No listings yet. Use the form on the left to create one."}))]),_:1})]),_:1})])}}});const Ue=ne(Ve,[["__scopeId","data-v-c958286e"]]);export{Ue as default};
