import{r as l,N as p,a as c}from"./index-1ba1cfa6.js";const y=a=>l.get("/goods",{params:a}),w=a=>l.get(`/goods/${a}`),$=a=>l.post("/goods",a),P=()=>l.get("/goods/mine"),h=(a,s)=>l.put(`/goods/${a}`,s),x=a=>l.delete(`/goods/${a}`),D=()=>l.get("/goods/pending"),I=(a,s)=>l.put(`/goods/${a}/review`,s),k=(a=6)=>l.get("/goods/hot",{params:{limit:a}}),L=a=>l.post(`/goods/${a}/view`),m=(a,s=10)=>l.get("/goods/ranking",{params:{metric:a,limit:s}}),q=p("goodsStore",()=>{const a=c([]),s=c([]),i=c([]),v=c(!1),u=c(null),r=c(!1),G=async o=>{v.value=!0;try{const{data:e}=await y(o);a.value=e}finally{v.value=!1}},g=async o=>{u.value=null;const{data:e}=await w(o);u.value=e},f=o=>{var t;if(o.status==="APPROVED"){const d=a.value.some(n=>n.id===o.id);a.value=d?a.value.map(n=>n.id===o.id?o:n):[o,...a.value]}else a.value=a.value.filter(d=>d.id!==o.id);s.value.findIndex(d=>d.id===o.id)>=0&&(s.value=s.value.map(d=>d.id===o.id?o:d)),((t=u.value)==null?void 0:t.id)===o.id&&(u.value=o)};return{goods:a,myGoods:s,pendingGoods:i,loading:v,pendingLoading:r,selectedGoods:u,loadGoods:G,loadGoodsById:g,createGoods:async o=>{const{data:e}=await $(o);return e.status==="APPROVED"&&(a.value=[e,...a.value]),s.value=[e,...s.value],e},loadMyGoods:async()=>{const{data:o}=await P();s.value=o},loadPendingGoods:async()=>{r.value=!0;try{const{data:o}=await D();i.value=o}finally{r.value=!1}},reviewGoods:async(o,e)=>{const{data:t}=await I(o,{status:e});return i.value=i.value.filter(d=>d.id!==o),f(t),t},updateGoods:async(o,e)=>{var d;const{data:t}=await h(o,e);return a.value=t.status==="APPROVED"?a.value.map(n=>n.id===o?t:n):a.value.filter(n=>n.id!==o),s.value=s.value.map(n=>n.id===o?t:n),((d=u.value)==null?void 0:d.id)===o&&(u.value=t),t},deleteGoods:async o=>{var e;await x(o),a.value=a.value.filter(t=>t.id!==o),s.value=s.value.filter(t=>t.id!==o),((e=u.value)==null?void 0:e.id)===o&&(u.value=null)}}});export{m as a,k as f,L as r,q as u};
