import{d as B,A as I,u as Q,b as F,c as D,o as O,w as U,e as u,f as g,h as c,i as d,n as _,m as p,p as y,g as s,F as T,k as Y,t as h,l as $,j,q as M,s as G,E as m,_ as L}from"./index-4373494d.js";import{g as z}from"./image-d30f5149.js";const w=v=>(M("data-v-cebfe150"),v=v(),G(),v),H={class:"cart-view"},J=w(()=>s("h1",null,"Shopping Cart",-1)),K={key:0,class:"empty-cart"},W={key:1,class:"cart-layout"},X={class:"cart-items"},Z=["src"],ee={class:"details"},te={class:"title-row"},oe={class:"price"},se={class:"stock"},ae={class:"actions"},ne={class:"cart-summary"},le=w(()=>s("h3",null,"Summary",-1)),ce=B({__name:"CartView",setup(v){const a=I(),C=Q(),i=F({}),S=D(()=>a.items.some(e=>e.goodsSold||e.goodsStatus!=="APPROVED")),k=()=>{const e=new Set;a.items.forEach(o=>{e.add(o.id),i[o.id]=o.quantity}),Object.keys(i).forEach(o=>{const l=Number(o);e.has(l)||Reflect.deleteProperty(i,l)})},V=async e=>{var l,n;const o=i[e.id];if(!(!o||o===e.quantity))try{await a.changeQuantity(e.id,{quantity:o}),m.success("Quantity updated")}catch(r){i[e.id]=e.quantity;const f=((n=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:n.message)||"Failed to update quantity";m.error(f)}},x=async e=>{var o,l;try{await a.removeItem(e),Reflect.deleteProperty(i,e),m.success("Removed from cart")}catch(n){const r=((l=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:l.message)||"Failed to remove item";m.error(r)}},R=async()=>{const e=await a.purgeSold();e>0?m.success(`Removed ${e} unavailable item(s)`):m.info("No unavailable items found")},P=()=>C.push("/orders"),E=()=>C.push("/goods");return O(async()=>{await a.loadCart(),k()}),U(()=>a.items,()=>{k()},{deep:!0}),(e,o)=>{const l=u("el-skeleton-item"),n=u("el-button"),r=u("el-empty"),f=u("el-tag"),N=u("el-input-number"),q=u("el-skeleton"),A=u("el-card");return _(),g("div",H,[J,c(A,null,{default:d(()=>[c(q,{loading:p(a).loading,animated:""},{template:d(()=>[c(l,{variant:"rect",style:{width:"100%",height:"140px","margin-bottom":"16px"}})]),default:d(()=>[p(a).items.length?(_(),g("div",W,[s("div",X,[(_(!0),g(T,null,Y(p(a).items,t=>(_(),g("div",{key:t.id,class:"cart-item"},[s("img",{src:t.goodsCoverImageUrl||p(z)(t.goodsCategory||"Daily"),alt:"",class:"thumbnail"},null,8,Z),s("div",ee,[s("div",te,[s("h3",null,h(t.goodsTitle),1),t.goodsSold||t.goodsStatus!=="APPROVED"?(_(),$(f,{key:0,type:"danger"},{default:d(()=>[y(" Unavailable ")]),_:1})):j("",!0)]),s("div",oe,"CNY "+h(t.goodsPrice??"--"),1),s("div",se," In stock: "+h(t.goodsQuantityAvailable??0),1),s("div",ae,[c(N,{modelValue:i[t.id],"onUpdate:modelValue":b=>i[t.id]=b,min:1,max:t.goodsQuantityAvailable??1,disabled:t.goodsSold||t.goodsStatus!=="APPROVED",onChange:b=>V(t)},null,8,["modelValue","onUpdate:modelValue","max","disabled","onChange"]),c(n,{type:"text",onClick:b=>x(t.id)},{default:d(()=>[y("Remove")]),_:2},1032,["onClick"])])])]))),128))]),s("div",ne,[le,s("p",null,"Total items: "+h(p(a).totalQuantity),1),s("p",null,"Total amount: CNY "+h(p(a).totalAmount.toFixed(2)),1),c(n,{type:"warning",plain:"",onClick:R,disabled:!S.value},{default:d(()=>[y(" Remove unavailable items ")]),_:1},8,["disabled"]),c(n,{type:"primary",class:"checkout-btn",onClick:P},{default:d(()=>[y(" Go to orders ")]),_:1})])])):(_(),g("div",K,[c(r,{description:"Your cart is empty"},{default:d(()=>[c(n,{type:"primary",onClick:E},{default:d(()=>[y("Browse goods")]),_:1})]),_:1})]))]),_:1},8,["loading"])]),_:1})])}}});const re=L(ce,[["__scopeId","data-v-cebfe150"]]);export{re as default};
