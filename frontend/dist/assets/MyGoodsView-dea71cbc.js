import{d as j,u as z,v as N,m as O,o as $,r as a,a as E,e,w as o,f as d,b as r,g as i,k as b,j as y,F as J,h as Y,E as x,t as m,q as D,z as H,p as K,i as Q,_ as X}from"./index-bb0676e0.js";import{u as Z}from"./goodsStore-dad07cae.js";import{g as U}from"./image-d30f5149.js";const G=g=>(K("data-v-2e7757ac"),g=g(),Q(),g),ee={class:"my-goods-view"},te={class:"card-header"},oe=G(()=>r("span",null,"Create New Listing",-1)),se={class:"list-header"},le=G(()=>r("h2",null,"My Listings",-1)),ae=["src"],re={class:"goods-body"},ne={class:"title-line"},de={class:"tag-group"},ie={class:"price"},ce={class:"description"},ue=j({__name:"MyGoodsView",setup(g){const c=Z(),I=z(),w=N(),v=N(!1),s=O({title:"",description:"",category:"",price:1,coverImageUrl:""}),P={title:[{required:!0,message:"Title is required",trigger:"blur"}],category:[{required:!0,message:"Select a category",trigger:"change"}],price:[{required:!0,message:"Price is required",trigger:"change"}],description:[{required:!0,message:"Description is required",trigger:"blur"}]};$(()=>{c.loadMyGoods()});const S=()=>{c.loadMyGoods()},L=()=>{var p;(p=w.value)==null||p.validate(async l=>{if(l){v.value=!0;try{const n={...s};n.coverImageUrl||(n.coverImageUrl=U(n.category));const _=await c.createGoods(n);x.success("Listing submitted for review"),k(),c.loadMyGoods(),I.push(`/goods/${_.id}`)}catch{x.error("Failed to create listing")}finally{v.value=!1}}})},k=()=>{s.title="",s.description="",s.category="",s.price=1,s.coverImageUrl=""},M=p=>I.push(`/goods/${p}`),q={PENDING_REVIEW:"Pending Review",APPROVED:"Approved",REJECTED:"Rejected"},B={PENDING_REVIEW:"warning",APPROVED:"success",REJECTED:"danger"};return(p,l)=>{const n=a("el-tag"),_=a("el-input"),u=a("el-form-item"),h=a("el-option"),T=a("el-select"),F=a("el-input-number"),f=a("el-button"),A=a("el-form"),C=a("el-card"),V=a("el-col"),W=a("el-empty"),R=a("el-row");return d(),E("div",ee,[e(R,{gutter:24},{default:o(()=>[e(V,{xs:24,md:10},{default:o(()=>[e(C,{class:"form-card"},{header:o(()=>[r("div",te,[oe,e(n,{type:"info"},{default:o(()=>[i("Practice mode")]),_:1})])]),default:o(()=>[e(A,{ref_key:"formRef",ref:w,model:s,rules:P,"label-position":"top"},{default:o(()=>[e(u,{label:"Title",prop:"title"},{default:o(()=>[e(_,{modelValue:s.title,"onUpdate:modelValue":l[0]||(l[0]=t=>s.title=t),placeholder:"Example: Lightly used textbook",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(u,{label:"Category",prop:"category"},{default:o(()=>[e(T,{modelValue:s.category,"onUpdate:modelValue":l[1]||(l[1]=t=>s.category=t),placeholder:"Select category"},{default:o(()=>[e(h,{label:"Electronics",value:"Electronics"}),e(h,{label:"Books",value:"Books"}),e(h,{label:"Daily",value:"Daily"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"Price (CNY)",prop:"price"},{default:o(()=>[e(F,{modelValue:s.price,"onUpdate:modelValue":l[2]||(l[2]=t=>s.price=t),min:.01,step:1},null,8,["modelValue"])]),_:1}),e(u,{label:"Description",prop:"description"},{default:o(()=>[e(_,{modelValue:s.description,"onUpdate:modelValue":l[3]||(l[3]=t=>s.description=t),type:"textarea",rows:4,placeholder:"Add detail such as condition, included accessories, etc."},null,8,["modelValue"])]),_:1}),e(u,{label:"Cover Image URL (optional)",prop:"coverImageUrl"},{default:o(()=>[e(_,{modelValue:s.coverImageUrl,"onUpdate:modelValue":l[4]||(l[4]=t=>s.coverImageUrl=t),placeholder:"Leave empty to auto-generate a placeholder"},null,8,["modelValue"])]),_:1}),e(u,null,{default:o(()=>[e(f,{type:"primary",loading:v.value,onClick:L},{default:o(()=>[i("Submit")]),_:1},8,["loading"]),e(f,{onClick:k},{default:o(()=>[i("Reset")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),e(V,{xs:24,md:14},{default:o(()=>[r("div",se,[le,e(f,{type:"text",onClick:S},{default:o(()=>[i("Refresh")]),_:1})]),b(c).myGoods.length?(d(),y(R,{key:1,gutter:16},{default:o(()=>[(d(!0),E(J,null,Y(b(c).myGoods,t=>(d(),y(V,{key:t.id,xs:24,sm:12},{default:o(()=>[e(C,{shadow:"hover",class:"goods-card"},{default:o(()=>[r("img",{src:t.coverImageUrl||b(U)(t.category),alt:"",class:"goods-cover"},null,8,ae),r("div",re,[r("div",ne,[r("h3",null,m(t.title),1),r("div",de,[e(n,{type:B[t.status],size:"small"},{default:o(()=>[i(m(q[t.status]),1)]),_:2},1032,["type"]),t.sold?(d(),y(n,{key:0,type:"warning",size:"small"},{default:o(()=>[i("Sold")]),_:1})):D("",!0)])]),r("p",ie,"CNY "+m(t.price),1),r("p",ce,m(t.description),1),t.status!=="APPROVED"?(d(),E("p",{key:0,class:H(["status-hint",t.status==="PENDING_REVIEW"?"pending":"rejected"])},m(t.status==="PENDING_REVIEW"?"Waiting for admin review":"Rejected by admin. Edit and resubmit."),3)):D("",!0),e(f,{type:"text",onClick:pe=>M(t.id)},{default:o(()=>[i("View detail")]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(d(),y(W,{key:0,description:"No listings yet. Use the form on the left to create one."}))]),_:1})]),_:1})])}}});const fe=X(ue,[["__scopeId","data-v-2e7757ac"]]);export{fe as default};
